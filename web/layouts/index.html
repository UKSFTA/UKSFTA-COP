{{ define "main" }}
<!-- Access Control Landing (Centered) -->
<div id="access-control" class="govuk-width-container govuk-!-margin-top-9">
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
            <span class="govuk-caption-xl">UKSF TASKFORCE ALPHA</span>
            <h1 class="govuk-heading-xl">Intelligence & Surveillance Portal</h1>
            
            <div class="govuk-warning-text">
                <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
                <strong class="govuk-warning-text__text">
                    <span class="govuk-visually-hidden">Warning</span>
                    OFFICIAL-SENSITIVE: This system contains information related to national security. 
                    Unauthorised access or disclosure is a criminal offence under the Official Secrets Act.
                </strong>
            </div>

            <p class="govuk-body">Access is restricted to authorized UKSFTA personnel. All interactions are logged and audited by the Unit Intelligence Cell (G2).</p>
            
            <button class="govuk-button govuk-button--start" data-module="govuk-button" onclick="unlockPortal()">
                Enter Portal
                <svg class="govuk-button__start-icon" xmlns="http://www.w3.org/2000/svg" width="17.5" height="19" viewBox="0 0 33 40" aria-hidden="true" focusable="false">
                    <path fill="currentColor" d="M0 0h13l20 20-20 20H0l20-20z" />
                </svg>
            </button>
        </div>
    </div>
</div>

<!-- Main Portal (Wide Flexbox Layout) -->
<div id="portal-content" class="cop-dashboard" style="display: none;">
    
    <!-- Left: Strategic Map -->
    <div class="cop-map-area">
        <!-- Map Style Controls (Floating Top Right) -->
        <div style="position: absolute; right: 20px; top: 10px; z-index: 1000; background: rgba(255,255,255,0.9); padding: 5px; border: 2px solid #0b0c0c; box-shadow: 3px 3px 0px #0b0c0c;">
            <div class="govuk-radios govuk-radios--small govuk-radios--inline" data-module="govuk-radios">
                <div class="govuk-radios__item">
                    <input class="govuk-radios__input" id="style-os" name="map-style" type="radio" value="os" checked onchange="setMapStyle(this.value)">
                    <label class="govuk-label govuk-radios__label" for="style-os">OS Style</label>
                </div>
                <div class="govuk-radios__item">
                    <input class="govuk-radios__input" id="style-mil" name="map-style" type="radio" value="military" onchange="setMapStyle(this.value)">
                    <label class="govuk-label govuk-radios__label" for="style-mil">MIL Tactical</label>
                </div>
            </div>
        </div>
        <div id="map" style="border: 2px solid #0b0c0c;"></div>
    </div>

    <!-- Right: Command & Control -->
    <div class="cop-sidebar">
        <div class="govuk-panel govuk-panel--confirmation" style="background-color: #0b0c0c; border: 1px solid #4caf50; padding: 5px; margin-bottom: 10px; text-align: left;">
            <h2 class="govuk-panel__title" style="font-size: 0.9rem; margin-bottom: 2px;">LIVE SESSION</h2>
            <div class="govuk-panel__body" style="font-size: 0.75rem;">
                <span id="session-status" class="govuk-tag govuk-tag--grey govuk-!-font-size-14">OFFLINE</span>
                <span id="active-theatre-display" class="govuk-!-font-weight-bold" style="margin-left: 5px;">UNKNOWN</span>
            </div>
        </div>

        <h3 class="govuk-heading-s govuk-!-margin-bottom-2">Command & Control</h3>
        
        <!-- Theatre Selection -->
        <div class="govuk-form-group govuk-!-margin-bottom-2">
          <label class="govuk-label govuk-label--s" for="theatre-select">AO</label>
          <select class="govuk-select govuk-!-width-full govuk-!-font-size-14" id="theatre-select" name="theatre" onchange="changeTheatre(this.value)">
            {{ range .Site.Data.theatres.categories }}
            <optgroup label="{{ .label }}">
                {{ range .maps }}<option value="{{ .id }}">{{ .name }}</option>{{ end }}
            </optgroup>
            {{ end }}
          </select>
        </div>

        <!-- Objective Identifier -->
        <div class="govuk-form-group govuk-!-margin-bottom-2">
          <label class="govuk-label govuk-label--s" for="marker-text">Objective / PL</label>
          <input class="govuk-input govuk-!-width-full govuk-!-font-size-14" id="marker-text" name="marker-text" type="text" placeholder="e.g. OBJ ALPHA">
        </div>

        <!-- Operator Callsign -->
        <div class="govuk-form-group govuk-!-margin-bottom-2">
          <label class="govuk-label govuk-label--s" for="operator-callsign">Callsign</label>
          <input class="govuk-input govuk-!-width-full govuk-!-font-size-14" id="operator-callsign" name="operator-callsign" type="text" placeholder="e.g. Z-1">
        </div>

        <!-- Hostility Classification -->
        <div class="govuk-form-group govuk-!-margin-bottom-2">
            <fieldset class="govuk-fieldset">
                <legend class="govuk-fieldset__legend govuk-fieldset__legend--s" style="font-size: 14px;">Hostility</legend>
                <div class="govuk-button-group govuk-!-margin-bottom-0">
                  <button class="govuk-button govuk-!-font-size-14" style="margin-right: 2px; padding: 5px 10px;" data-module="govuk-button" onclick="setColor('#0000ff')">BLU</button>
                  <button class="govuk-button govuk-button--warning govuk-!-font-size-14" style="margin-right: 2px; padding: 5px 10px;" data-module="govuk-button" onclick="setColor('#ff0000')">OPF</button>
                  <button class="govuk-button govuk-button--secondary govuk-!-font-size-14" style="margin-right: 2px; padding: 5px 10px;" data-module="govuk-button" onclick="setColor('#00ff00')">IND</button>
                </div>
            </fieldset>
        </div>

        <!-- Symbol Selection -->
        <div class="govuk-form-group govuk-!-margin-bottom-2">
          <label class="govuk-label govuk-label--s" for="symbol-select">NATO Symbol (APP-6D)</label>
          <select class="govuk-select govuk-!-width-full govuk-!-font-size-14" id="symbol-select" onchange="setSymbol(this.value)">
            <optgroup label="Ground Forces">
                <option value="b_inf">Infantry (Light)</option>
                <option value="b_motor_inf">Inf (Motorized)</option>
                <option value="b_mech_inf">Inf (Mech)</option>
                <option value="b_armor">Armor (MBT)</option>
                <option value="b_recon">Recon (Cav)</option>
                <option value="b_hq">HQ Node</option>
            </optgroup>
            <optgroup label="Support">
                <option value="b_art">Arty (AS90)</option>
                <option value="b_mor">Mortars</option>
                <option value="b_med">Medical (RAP)</option>
                <option value="b_eng">Engrs (RE)</option>
                <option value="b_air">Avn (RW)</option>
                <option value="b_uav">UAV</option>
            </optgroup>
          </select>
        </div>

        <!-- Actions -->
        <button id="save-drawings" class="govuk-button govuk-!-width-full govuk-!-margin-bottom-2 govuk-!-font-size-14" data-module="govuk-button">Publish Intelligence</button>
        <button id="measure-status" class="govuk-button govuk-button--secondary govuk-!-width-full govuk-!-margin-bottom-2 govuk-!-font-size-14" data-module="govuk-button" onclick="toggleMeasure()">Rangefinder</button>

        <div class="govuk-checkboxes govuk-checkboxes--small" data-module="govuk-checkboxes">
            <div class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="show-grid" name="grid" type="checkbox" checked onchange="toggleGrid(this.checked)">
                <label class="govuk-label govuk-checkboxes__label govuk-!-font-size-14" for="show-grid">Show 1km Grid</label>
            </div>
        </div>

        <div class="govuk-inset-text govuk-!-margin-top-2 govuk-!-margin-bottom-2" style="border-left-color: #003078; padding: 5px 10px;">
            <p class="govuk-body-s" id="upload-status" style="margin-bottom: 2px;">STATUS: IDLE</p>
            <p class="govuk-body-s govuk-!-font-weight-bold" id="grid-ref" style="font-family: monospace;">GRID: WAITING...</p>
        </div>
    </div>
</div>
{{ end }}
